// SPDX-License-Identifier: GPL-2.0+
/*
 * Copyright 2020 TQ Systems GmbH
 */

#include "imx8mn-em4xx.dtsi"

/ {
	aliases {
		ethernet1 = &lan1;
	};
};

&iomuxc {
	pinctrl_fec1mdio: fec1mdiogrp {
		fsl,pins = <
			MX8MN_IOMUXC_ENET_MDC_ENET1_MDC			0x0
			MX8MN_IOMUXC_ENET_MDIO_ENET1_MDIO		0x0
		>;
	};

	pinctrl_switch_irq: switchgrp {
		fsl,pins = <
			MX8MN_IOMUXC_ENET_RD3_GPIO1_IO29		0x10
		>;
	};
};

&fec1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_fec1 &pinctrl_fec1mdio>;
	phy-mode = "rmii";
	phy-reset-gpios = <&gpio1 28 GPIO_ACTIVE_LOW>;
	phy-reset-duration = <500>;
	phy-reset-post-delay = <20>; /* mv88e6020 needs 10 ms */
	status = "okay";

	fixedphy: fixed-link {
		speed = <100>;
		full-duplex;
	};

	mdio {
		#address-cells = <1>;
		#size-cells = <0>;
		status = "okay";

		switch: switch@10 {
			compatible = "marvell,mv88e6250";
			pinctrl-0 = <&pinctrl_switch_irq>;
			pinctrl-names = "default";
			reg = <0x10>;
			interrupt-parent = <&gpio1>;
			interrupts = <29 IRQ_TYPE_LEVEL_LOW>;
			interrupt-controller;
			#interrupt-cells = <2>;

			ports {
				#address-cells = <1>;
				#size-cells = <0>;

				lan0: port@0 {
					reg = <0>;
					phy-mode = "internal";
					label = "lan0";
					phy-handle = <&switchphy10>;
				};

				lan1: port@1 {
					reg = <1>;
					phy-mode = "internal";
					label = "lan1";
					phy-handle = <&switchphy11>;
				};

				port@5 {
					reg = <5>;
					label = "cpu";
					ethernet = <&fec1>;
					phy-mode = "rmii";

					fixed-link {
						speed = <100>;
						full-duplex;
					};
				};
			};

			mdio {
				#address-cells = <1>;
				#size-cells = <0>;

				switchphy10: switchphy@10 {
					reg = <0x10>;
					interrupt-parent = <&switch>;
					interrupts = <0 IRQ_TYPE_LEVEL_HIGH>;
				};

				switchphy11: switchphy@11 {
					reg = <0x11>;
					interrupt-parent = <&switch>;
					interrupts = <1 IRQ_TYPE_LEVEL_HIGH>;
				};
			};
		};
	};
};
